<!-- habitat-begin -->
# Claude Habitat Rules

This file is auto-generated by claude-habitat from preset rules and skills.

## Available Skills

When working on tasks, consider using the `skill_resolve` MCP tool to load structured protocols:

- **project-iterate** — "Self-recursive project iteration protocol. Drives all multi-step work through a unified leaf execution cycle."

Usage: Call `skill_resolve` with the skill name to get step-by-step guidance.

## Rules

## Security Standards

When working with security-sensitive code:

1. **Input Validation**: Validate and sanitize all external input.
2. **Authentication**: Use proven auth libraries. Never roll your own crypto.
3. **Secrets Management**: Never hardcode secrets, tokens, or passwords.
4. **SQL Injection**: Use parameterized queries. Never concatenate user input into SQL.
5. **XSS Prevention**: Escape output in HTML contexts. Use Content Security Policy.
6. **CSRF Protection**: Use anti-CSRF tokens for state-changing operations.
7. **Dependencies**: Keep dependencies updated. Audit for known vulnerabilities.

## Code Quality Standards

When writing or modifying code, follow these quality standards:

1. **Readability**: Write clear, self-documenting code. Use meaningful variable and function names.
2. **Simplicity**: Prefer simple solutions over clever ones. Avoid unnecessary abstractions.
3. **DRY**: Don't repeat yourself, but don't over-abstract for a single use case.
4. **Error Handling**: Handle errors at system boundaries. Use appropriate error types.
5. **Testing**: Write tests for new functionality. Ensure edge cases are covered.
6. **Security**: Never hardcode secrets. Validate external input. Follow OWASP guidelines.
7. **Performance**: Avoid premature optimization, but don't introduce obvious inefficiencies.

## Testing Standards

When writing or reviewing tests:

1. **Coverage**: Test happy paths, edge cases, and error conditions.
2. **Independence**: Tests should not depend on execution order.
3. **Clarity**: Test names should describe the behavior being tested.
4. **Isolation**: Mock external dependencies. Tests should be deterministic.
5. **Boundaries**: Test boundary values and off-by-one scenarios.
6. **Regression**: Add a test for every bug fix to prevent recurrence.

## Documentation Standards

When creating or updating documentation:

1. **Completeness**: Document all public APIs, configuration options, and setup steps.
2. **Accuracy**: Keep documentation in sync with code changes.
3. **Examples**: Include practical examples for complex features.
4. **Structure**: Use clear headings, lists, and code blocks for readability.
5. **Audience**: Write for the intended audience — avoid jargon when possible.

### Workflow Execution Protocol

**Session Start:**
1. Call `workflow_status` first
2. If active workflow exists → call `skill_resolve("project-iterate")` and follow it
3. If no active workflow and task ≥ 3 steps → create seed workflow, then enter Leaf Execution Cycle

**Plan Mode Guidelines:**
- Part 2 (Design Iteration) of every leaf should use `EnterPlanMode` for exploration and design when design decisions are needed
- After `ExitPlanMode`, persist the approved plan via `doc_create` before any workflow mutation
- Plans flow through: Plan Mode → `doc_create` → workflow tree mutation → leaf execution → TodoList

**Rule Feedback (Part 2.5):**
- Call `session_stats({ format: "markdown" })` to review rule activity
- Create or update rules via `rule_create`/`rule_update` if gaps are found
- Rule/skill changes automatically refresh CLAUDE.md and RuleEngine

**General Guidelines:**
- Include trailing "Design iteration", "Rule feedback", and "State transition" TodoList items in each leaf
- Stay within the current leaf node's scope
- The Leaf Execution Cycle (Part 1 → Part 2 → Part 2.5 → Part 3) is the single flow. Bootstrap and expand_composite are handled naturally within the cycle

> **REQUIRED:** When this rule applies, you MUST call `skill_resolve("project-iterate")` to load the protocol and follow its steps.

### Workflow Execution Protocol

**Session Start:**
1. Call `workflow_status` first
2. If active workflow exists → call `skill_resolve("project-iterate")` and follow it
3. If no active workflow and task ≥ 3 steps → create seed workflow, then enter Leaf Execution Cycle

**Plan Mode Guidelines:**
- Part 2 (Design Iteration) of every leaf should use `EnterPlanMode` for exploration and design when design decisions are needed
- After `ExitPlanMode`, persist the approved plan via `doc_create` before any workflow mutation
- Plans flow through: Plan Mode → `doc_create` → workflow tree mutation → leaf execution → TodoList

**Rule Feedback (Part 2.5):**
- Call `session_stats({ format: "markdown" })` to review rule activity
- Create or update rules via `rule_create`/`rule_update` if gaps are found
- Rule/skill changes automatically refresh CLAUDE.md and RuleEngine

**General Guidelines:**
- Include trailing "Design iteration", "Rule feedback", and "State transition" TodoList items in each leaf
- Stay within the current leaf node's scope
- The Leaf Execution Cycle (Part 1 → Part 2 → Part 2.5 → Part 3) is the single flow. Bootstrap and expand_composite are handled naturally within the cycle

<!-- habitat-end -->
